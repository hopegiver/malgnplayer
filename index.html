<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MalgnPlayer Test</title>
    <style>
        .player-container {
            width: 800px;
            height: 450px;
            margin: 20px auto;
            background: #000;
        }
        .autoloop-container {
            width: 600px;
            height: 300px;
            margin: 20px auto;
            background: #000;
            border-radius: 8px;
            overflow: hidden;
        }
        .controls {
            text-align: center;
            margin: 20px;
        }
        button {
            margin: 5px;
            padding: 10px 15px;
        }
        .section-title {
            text-align: center;
            margin: 40px 0 20px 0;
            color: #333;
            border-bottom: 2px solid #007acc;
            padding-bottom: 10px;
        }
        .demo-info {
            text-align: center;
            margin: 10px 0;
            padding: 10px;
            background: #f0f8ff;
            border-radius: 6px;
            color: #555;
        }
        .segment-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin: 15px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }
        .segment-controls label {
            font-weight: bold;
            color: #495057;
        }
        .segment-controls input {
            width: 60px;
            padding: 5px 8px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            text-align: center;
            font-size: 14px;
        }
        .segment-controls button {
            padding: 8px 16px;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        .segment-controls button:hover {
            background: #218838;
        }
    </style>
</head>
<body>
    <h1>MalgnPlayer Test</h1>

    <h2 class="section-title">ğŸ“º ê¸°ë³¸ í”Œë ˆì´ì–´ (ì»¨íŠ¸ë¡¤ í¬í•¨)</h2>
    <div id="player" class="player-container"></div>

    <div class="controls">
        <button onclick="player.play()">Play</button>
        <button onclick="player.pause()">Pause</button>
        <button onclick="player.stop()">Stop</button>
        <button onclick="player.togglePlay()">Toggle Play</button>
        <button onclick="player.restart()">Restart</button>
        <button onclick="player.rewind(10)">Rewind 10s</button>
        <button onclick="player.fastForward(10)">Forward 10s</button>
        <button onclick="player.setVolume(0.5)">Volume 50%</button>
        <button onclick="player.setMute(!player.getMute())">Toggle Mute</button>
    </div>

    <div class="controls">
        <button onclick="player.playlistNext()">Next</button>
        <button onclick="player.playlistPrev()">Previous</button>
        <button onclick="player.setPoster('https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/images/ElephantsDream.jpg')">Change Poster</button>
        <button onclick="console.log('Playing:', player.isPlaying(), 'Buffer:', player.getBuffer() + '%')">Log Status</button>
    </div>

    <div class="controls">
        <button onclick="loadSingleVideo()">Load Single Video</button>
        <button onclick="loadPlaylist()">Load Playlist</button>
        <button onclick="loadHLS()">Load HLS Stream</button>
        <button onclick="loadVideoWithType()">Load Video (Type: MP4)</button>
        <button onclick="loadHLSWithType()">Load HLS (Type: HLS)</button>
    </div>

    <h2 class="section-title">ğŸ”„ Autoloop í”Œë ˆì´ì–´ (GIFì²˜ëŸ¼ ë™ì‘)</h2>
    <div class="demo-info">
        5~20ì´ˆ êµ¬ê°„ë§Œ ìì—°ìŠ¤ëŸ½ê²Œ ë¬´í•œ ë£¨í”„ë©ë‹ˆë‹¤ (ê¹Œë§Œ í™”ë©´ ì—†ìŒ). ê¸°ë³¸ ì„¤ì •ìœ¼ë¡œ êµ¬ê°„ì„ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    </div>
    <div id="autoloop-player" class="autoloop-container"></div>

    <div class="segment-controls">
        <label>í˜„ì¬ ì‹œê°„: <span id="currentTimeDisplay">0.0</span>ì´ˆ</label>
        <label>|</label>
        <label>êµ¬ê°„ ì„¤ì •:</label>
        <label>ì‹œì‘</label>
        <input type="number" id="startTime" value="0" min="0" step="0.1" placeholder="0">
        <label>ì´ˆ ~</label>
        <label>ë</label>
        <input type="number" id="endTime" value="15" min="0.1" step="0.1" placeholder="15">
        <label>ì´ˆ</label>
        <button onclick="setCustomSegment()">êµ¬ê°„ ë£¨í”„ ì‹œì‘</button>
        <button onclick="getCurrentSegment()">í˜„ì¬ êµ¬ê°„ ê°€ì ¸ì˜¤ê¸°</button>
    </div>

    <div class="controls">
        <button onclick="enableAutoloop()">Autoloop í™œì„±í™”</button>
        <button onclick="disableAutoloop()">Autoloop ë¹„í™œì„±í™”</button>
        <button onclick="setLoop10()">10ì´ˆ ë£¨í”„</button>
        <button onclick="setLoop15()">15ì´ˆ ë£¨í”„</button>
        <button onclick="setLoop30()">30ì´ˆ ë£¨í”„</button>
        <button onclick="setSeamlessLoop()">ì „ì²´ Seamless ë£¨í”„</button>
        <button onclick="setSegmentLoop()">êµ¬ê°„ ë£¨í”„ (5-20ì´ˆ)</button>
        <button onclick="showAutoloopStatus()">ìƒíƒœ í™•ì¸</button>
    </div>

    <script type="module">
        import MalgnPlayer from './src/malgnplayer.js';

        // Initialize player with initial media
        const player = new MalgnPlayer('player', {
            width: '800px',
            height: '450px',
            controls: true,
            muted: false,
            file: 'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4',
            type: 'mp4',
            title: 'Big Buck Bunny',
            poster: 'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/images/BigBuckBunny.jpg'
        });

        // Initialize autoloop player (always seamless)
        const autoloopPlayer = new MalgnPlayer('autoloop-player', {
            file: 'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4',
            width: '800px',
            height: '450px',
            autoloop: true,
            loopStartTime: 5,     // Start from 5 seconds
            loopEndTime: 20,      // End at 20 seconds
            muted: true
        });

        // Make players globally available for button onclick handlers
        window.player = player;
        window.autoloopPlayer = autoloopPlayer;

        // Event listeners
        player.on('play', (data) => {
            console.log('Playing:', data);
        });

        player.on('pause', (data) => {
            console.log('Paused:', data);
        });

        player.on('ended', (data) => {
            console.log('Ended:', data);
        });

        player.on('timeupdate', (data) => {
            // console.log('Time update:', data.currentTime);
        });

        // Test functions
        window.loadSingleVideo = () => {
            player.load({
                file: 'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4',
                title: 'Big Buck Bunny',
                poster: 'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/images/BigBuckBunny.jpg'
            });
        };

        window.loadPlaylist = () => {
            player.load({
                sources: [
                    {
                        file: 'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4',
                        title: 'Big Buck Bunny',
                        poster: 'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/images/BigBuckBunny.jpg'
                    },
                    {
                        file: 'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ElephantsDream.mp4',
                        title: 'Elephants Dream',
                        poster: 'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/images/ElephantsDream.jpg'
                    }
                ]
            });
        };

        window.loadHLS = () => {
            player.load({
                file: 'https://d2zihajmogu5jn.cloudfront.net/bipbop-advanced/bipbop_16x9_variant.m3u8',
                title: 'HLS Test Stream',
                poster: 'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/images/BigBuckBunny.jpg'
            });
        };

        // Example with explicit type specification
        window.loadVideoWithType = () => {
            player.load({
                file: 'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4',
                type: 'mp4',
                title: 'Video with explicit MP4 type',
                poster: 'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/images/BigBuckBunny.jpg'
            });
        };

        window.loadHLSWithType = () => {
            player.load({
                file: 'https://d2zihajmogu5jn.cloudfront.net/bipbop-advanced/bipbop_16x9_variant.m3u8',
                type: 'hls',
                title: 'HLS stream with explicit type',
                poster: 'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/images/BigBuckBunny.jpg'
            });
        };

        // Autoloop control functions (always seamless)
        window.enableAutoloop = async () => {
            await autoloopPlayer.setAutoloop(true);
            console.log('Autoloop enabled (seamless)');
        };

        window.disableAutoloop = async () => {
            await autoloopPlayer.setAutoloop(false);
            console.log('Autoloop disabled');
        };

        window.setLoop10 = async () => {
            autoloopPlayer.setLoopSegment(0, 10); // First 10 seconds
            await autoloopPlayer.setAutoloop(true);
            console.log('Loop set to first 10 seconds');
        };

        window.setLoop15 = async () => {
            autoloopPlayer.setLoopSegment(0, 15); // First 15 seconds
            await autoloopPlayer.setAutoloop(true);
            console.log('Loop set to first 15 seconds');
        };

        window.setLoop30 = async () => {
            autoloopPlayer.setLoopSegment(0, 30); // First 30 seconds
            await autoloopPlayer.setAutoloop(true);
            console.log('Loop set to first 30 seconds');
        };

        window.setSeamlessLoop = async () => {
            autoloopPlayer.setLoopSegment(0, null); // Full video loop
            await autoloopPlayer.setAutoloop(true);
            console.log('Full video loop enabled');
        };

        window.setSegmentLoop = async () => {
            autoloopPlayer.setLoopSegment(5, 20); // 5-20 seconds
            await autoloopPlayer.setAutoloop(true);
            console.log('Segment loop enabled (5-20 seconds)');
        };

        window.setCustomSegment = async () => {
            const startTime = parseFloat(document.getElementById('startTime').value) || 0;
            const endTimeInput = document.getElementById('endTime').value;
            const endTime = endTimeInput ? parseFloat(endTimeInput) : null;

            // Validation
            if (endTime !== null && startTime >= endTime) {
                alert('ì‹œì‘ ì‹œê°„ì€ ë ì‹œê°„ë³´ë‹¤ ì‘ì•„ì•¼ í•©ë‹ˆë‹¤.');
                return;
            }

            if (startTime < 0) {
                alert('ì‹œì‘ ì‹œê°„ì€ 0 ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.');
                return;
            }

            // Apply custom segment
            autoloopPlayer.setLoopSegment(startTime, endTime);
            await autoloopPlayer.setAutoloop(true);

            const endTimeText = endTime !== null ? `${endTime}ì´ˆ` : 'ëê¹Œì§€';
            console.log(`ì»¤ìŠ¤í…€ êµ¬ê°„ ë£¨í”„: ${startTime}ì´ˆ ~ ${endTimeText}`);
            alert(`êµ¬ê°„ ë£¨í”„ ì‹œì‘: ${startTime}ì´ˆ ~ ${endTimeText}`);
        };

        window.getCurrentSegment = () => {
            const currentTime = autoloopPlayer.getCurrentTime();
            const duration = autoloopPlayer.getDuration();

            document.getElementById('startTime').value = Math.max(0, currentTime - 5).toFixed(1);
            document.getElementById('endTime').value = Math.min(duration, currentTime + 10).toFixed(1);

            console.log(`í˜„ì¬ ìœ„ì¹˜ ê¸°ì¤€ êµ¬ê°„ ì„¤ì •: ${currentTime.toFixed(1)}ì´ˆ ì£¼ë³€`);
        };

        window.showAutoloopStatus = () => {
            const status = autoloopPlayer.getAutoloop();
            const currentTime = autoloopPlayer.getCurrentTime();
            const message = `Autoloop ìƒíƒœ: ${status.enabled ? 'í™œì„±í™”' : 'ë¹„í™œì„±í™”'}\ní˜„ì¬ ì¬ìƒ ì‹œê°„: ${currentTime.toFixed(1)}ì´ˆ\në£¨í”„ ì‹œì‘: ${status.startTime}ì´ˆ\në£¨í”„ ì¢…ë£Œ: ${status.endTime || 'ì „ì²´'}ì´ˆ`;
            alert(message);
            console.log('Autoloop status:', status, 'Current time:', currentTime);
        };

        // Autoloop player event listeners
        autoloopPlayer.on('play', () => {
            console.log('Autoloop player started');
        });

        autoloopPlayer.on('ended', () => {
            console.log('Autoloop player ended (will restart automatically)');
        });

        // Update current time display
        autoloopPlayer.on('timeupdate', (data) => {
            const currentTimeDisplay = document.getElementById('currentTimeDisplay');
            if (currentTimeDisplay) {
                currentTimeDisplay.textContent = data.currentTime.toFixed(1);
            }
        });

        // Default video is already loaded via initial options
    </script>
</body>
</html>